syntax = "proto3";

package com.gastroflow.restaurants;

import "common/types.proto";
import "common/enums.proto";
import "validate/validate.proto";

option go_package = "github.com/gastroflow/proto-go/restaurants";

// Restaurant - основная сущность ресторана
message Restaurant {
  // Уникальный идентификатор ресторана
  com.gastroflow.common.UUID id = 1 [(validate.rules).message.required = true];
  
  // Название ресторана
  string name = 2 [(validate.rules).string = {
    min_len: 1,
    max_len: 200
  }];
  
  // Описание ресторана
  string description = 3 [(validate.rules).string.max_len = 2000];
  
  // Тип кухни
  repeated CuisineType cuisine_types = 4 [(validate.rules).repeated.max_items = 10];
  
  // Основная контактная информация
  com.gastroflow.common.ContactInfo contact_info = 5 [(validate.rules).message.required = true];
  
  // Основной адрес ресторана
  com.gastroflow.common.Address address = 6 [(validate.rules).message.required = true];
  
  // Текущий статус работы
  com.gastroflow.common.RestaurantStatus status = 7 [(validate.rules).enum = {
    not_in: [0]
  }];
  
  // Настройки ресторана
  RestaurantSettings settings = 8 [(validate.rules).message.required = true];
  
  // График работы
  repeated WorkingHours working_hours = 9 [(validate.rules).repeated.max_items = 7];
  
  // Филиалы ресторана
  repeated Branch branches = 10 [(validate.rules).repeated.max_items = 100];
  
  // Логотип ресторана
  string logo_url = 11 [(validate.rules).string.max_len = 500];
  
  // Фотографии ресторана
  repeated string images = 12 [(validate.rules).repeated = {
    max_items: 20,
    items: {string: {max_len: 500}}
  }];
  
  // Рейтинг ресторана (1-5)
  double rating = 13 [(validate.rules).double = {
    gte: 1.0,
    lte: 5.0
  }];
  
  // Количество отзывов
  int32 review_count = 14 [(validate.rules).int32.gte = 0];
  
  // Средняя стоимость заказа
  com.gastroflow.common.Money average_order_value = 15;
  
  // Время доставки (мин/макс в минутах)
  DeliveryTimeRange delivery_time_range = 16;
  
  // Зона доставки
  DeliveryZone delivery_zone = 17;
  
  // Владелец ресторана
  com.gastroflow.common.UUID owner_id = 18 [(validate.rules).message.required = true];
  
  // Активность ресторана
  bool is_active = 19;
  
  // Информация об аудите
  com.gastroflow.common.AuditInfo audit_info = 20 [(validate.rules).message.required = true];
}

// Branch - филиал ресторана
message Branch {
  // Уникальный идентификатор филиала
  com.gastroflow.common.UUID id = 1 [(validate.rules).message.required = true];
  
  // Название филиала
  string name = 2 [(validate.rules).string = {
    min_len: 1,
    max_len: 200
  }];
  
  // Адрес филиала
  com.gastroflow.common.Address address = 3 [(validate.rules).message.required = true];
  
  // Контактная информация филиала
  com.gastroflow.common.ContactInfo contact_info = 4 [(validate.rules).message.required = true];
  
  // Статус филиала
  com.gastroflow.common.RestaurantStatus status = 5 [(validate.rules).enum = {
    not_in: [0]
  }];
  
  // График работы филиала
  repeated WorkingHours working_hours = 6 [(validate.rules).repeated.max_items = 7];
  
  // Настройки филиала (могут переопределять настройки ресторана)
  RestaurantSettings settings = 7;
  
  // Менеджер филиала
  com.gastroflow.common.UUID manager_id = 8;
  
  // Активность филиала
  bool is_active = 9;
  
  // Информация об аудите
  com.gastroflow.common.AuditInfo audit_info = 10 [(validate.rules).message.required = true];
}

// RestaurantSettings - настройки ресторана
message RestaurantSettings {
  // Принимает ли заказы на вынос
  bool accepts_takeaway = 1;
  
  // Принимает ли заказы с доставкой
  bool accepts_delivery = 2;
  
  // Принимает ли заказы в зале
  bool accepts_dine_in = 3;
  
  // Принимает ли заказы через внешние платформы (Яндекс.Еда и т.д.)
  bool accepts_external_orders = 4;
  
  // Автоматически принимает заказы без подтверждения
  bool auto_accept_orders = 5;
  
  // Минимальная сумма заказа для доставки
  com.gastroflow.common.Money minimum_delivery_order = 6;
  
  // Стоимость доставки
  com.gastroflow.common.Money delivery_fee = 7;
  
  // Бесплатная доставка от суммы
  com.gastroflow.common.Money free_delivery_threshold = 8;
  
  // Максимальное время приготовления (минуты)
  int32 max_preparation_time = 9 [(validate.rules).int32 = {
    gte: 1,
    lte: 480
  }];
  
  // Предварительное время приготовления по умолчанию
  int32 default_preparation_time = 10 [(validate.rules).int32 = {
    gte: 1,
    lte: 480
  }];
  
  // Принимаемые способы оплаты
  repeated com.gastroflow.common.PaymentMethod accepted_payment_methods = 11 [(validate.rules).repeated.max_items = 10];
  
  // Настройки уведомлений
  NotificationSettings notification_settings = 12;
  
  // Временная зона ресторана
  string timezone = 13 [(validate.rules).string.max_len = 50];
  
  // Валюта ресторана
  string currency = 14 [(validate.rules).string = {
    pattern: "^[A-Z]{3}$"
  }];
  
  // Язык по умолчанию
  com.gastroflow.common.Language default_language = 15 [(validate.rules).enum = {
    not_in: [0]
  }];
}

// WorkingHours - график работы
message WorkingHours {
  // День недели
  com.gastroflow.common.WeekDay day = 1 [(validate.rules).enum = {
    not_in: [0]
  }];
  
  // Работает ли в этот день
  bool is_working = 2;
  
  // Временные интервалы работы в течение дня
  repeated TimeInterval intervals = 3 [(validate.rules).repeated.max_items = 5];
  
  // Специальные часы (например, для праздников)
  bool is_special_hours = 4;
  
  // Комментарий к графику (например, "Сокращенный день")
  string comment = 5 [(validate.rules).string.max_len = 200];
}

// TimeInterval - временной интервал
message TimeInterval {
  // Время начала работы (HH:MM)
  string start_time = 1 [(validate.rules).string = {
    pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
  }];
  
  // Время окончания работы (HH:MM)
  string end_time = 2 [(validate.rules).string = {
    pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
  }];
  
  // Тип интервала (основные часы, обеденный перерыв и т.д.)
  IntervalType type = 3 [(validate.rules).enum = {
    not_in: [0]
  }];
}

// DeliveryTimeRange - диапазон времени доставки
message DeliveryTimeRange {
  // Минимальное время доставки (минуты)
  int32 min_delivery_time = 1 [(validate.rules).int32 = {
    gte: 5,
    lte: 300
  }];
  
  // Максимальное время доставки (минуты)
  int32 max_delivery_time = 2 [(validate.rules).int32 = {
    gte: 10,
    lte: 300
  }];
}

// DeliveryZone - зона доставки
message DeliveryZone {
  // Центральные координаты (ресторан)
  double center_latitude = 1 [(validate.rules).double = {
    gte: -90.0,
    lte: 90.0
  }];
  double center_longitude = 2 [(validate.rules).double = {
    gte: -180.0,
    lte: 180.0
  }];
  
  // Радиус доставки в километрах
  double radius_km = 3 [(validate.rules).double = {
    gte: 0.5,
    lte: 50.0
  }];
  
  // Полигональные зоны доставки (более точное определение)
  repeated DeliveryPolygon polygons = 4 [(validate.rules).repeated.max_items = 10];
}

// DeliveryPolygon - полигональная зона доставки
message DeliveryPolygon {
  // Точки полигона
  repeated GeoPoint points = 1 [(validate.rules).repeated = {
    min_items: 3,
    max_items: 100
  }];
  
  // Дополнительная стоимость доставки в этой зоне
  com.gastroflow.common.Money additional_fee = 2;
  
  // Название зоны
  string name = 3 [(validate.rules).string.max_len = 100];
}

// GeoPoint - географическая точка
message GeoPoint {
  double latitude = 1 [(validate.rules).double = {
    gte: -90.0,
    lte: 90.0
  }];
  double longitude = 2 [(validate.rules).double = {
    gte: -180.0,
    lte: 180.0
  }];
}

// NotificationSettings - настройки уведомлений
message NotificationSettings {
  // Уведомлять о новых заказах
  bool notify_new_orders = 1;
  
  // Уведомлять об отмене заказов
  bool notify_cancelled_orders = 2;
  
  // Уведомлять о готовности заказов
  bool notify_ready_orders = 3;
  
  // Уведомлять о проблемах с оплатой
  bool notify_payment_issues = 4;
  
  // Email для уведомлений
  string notification_email = 5 [(validate.rules).string = {
    pattern: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
  }];
  
  // Телефон для SMS уведомлений
  string notification_phone = 6 [(validate.rules).string = {
    pattern: "^\\+[1-9]\\d{10,14}$"
  }];
  
  // Способы уведомлений
  repeated NotificationChannel notification_channels = 7 [(validate.rules).repeated.max_items = 10];
}

// Енумы для домена Restaurants

// CuisineType - тип кухни
enum CuisineType {
  CUISINE_TYPE_UNSPECIFIED = 0;
  CUISINE_TYPE_ITALIAN = 1;          // Итальянская
  CUISINE_TYPE_JAPANESE = 2;         // Японская
  CUISINE_TYPE_CHINESE = 3;          // Китайская
  CUISINE_TYPE_MEXICAN = 4;          // Мексиканская
  CUISINE_TYPE_INDIAN = 5;           // Индийская
  CUISINE_TYPE_FRENCH = 6;           // Французская
  CUISINE_TYPE_AMERICAN = 7;         // Американская
  CUISINE_TYPE_MEDITERRANEAN = 8;    // Средиземноморская
  CUISINE_TYPE_THAI = 9;             // Тайская
  CUISINE_TYPE_KOREAN = 10;          // Корейская
  CUISINE_TYPE_RUSSIAN = 11;         // Русская
  CUISINE_TYPE_UZBEK = 12;           // Узбекская
  CUISINE_TYPE_GEORGIAN = 13;        // Грузинская
  CUISINE_TYPE_TURKISH = 14;         // Турецкая
  CUISINE_TYPE_FAST_FOOD = 15;       // Фаст-фуд
  CUISINE_TYPE_PIZZA = 16;           // Пицца
  CUISINE_TYPE_BURGER = 17;          // Бургеры
  CUISINE_TYPE_SUSHI = 18;           // Суши
  CUISINE_TYPE_GRILL = 19;           // Гриль
  CUISINE_TYPE_SEAFOOD = 20;         // Морепродукты
  CUISINE_TYPE_VEGETARIAN = 21;      // Вегетарианская
  CUISINE_TYPE_VEGAN = 22;           // Веганская
  CUISINE_TYPE_DESSERTS = 23;        // Десерты
  CUISINE_TYPE_COFFEE = 24;          // Кофе и напитки
}

// IntervalType - тип временного интервала
enum IntervalType {
  INTERVAL_TYPE_UNSPECIFIED = 0;
  INTERVAL_TYPE_WORKING = 1;         // Рабочие часы
  INTERVAL_TYPE_BREAK = 2;           // Перерыв
  INTERVAL_TYPE_CLEANING = 3;        // Санитарный час
  INTERVAL_TYPE_SPECIAL = 4;         // Специальные часы
}

// NotificationChannel - канал уведомлений
enum NotificationChannel {
  NOTIFICATION_CHANNEL_UNSPECIFIED = 0;
  NOTIFICATION_CHANNEL_EMAIL = 1;        // Email
  NOTIFICATION_CHANNEL_SMS = 2;          // SMS
  NOTIFICATION_CHANNEL_PUSH = 3;         // Push уведомления
  NOTIFICATION_CHANNEL_TELEGRAM = 4;     // Telegram
  NOTIFICATION_CHANNEL_WHATSAPP = 5;     // WhatsApp
  NOTIFICATION_CHANNEL_WEBHOOK = 6;      // Webhook
}