syntax = "proto3";

package com.gastroflow.orders;

import "common/enums.proto";
import "common/types.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/gastroflow/proto-go/orders";

// Order - основная сущность заказа в системе GastroFlow
message Order {
  // Уникальный идентификатор заказа
  com.gastroflow.common.UUID id = 1;

  // Имя клиента
  string name = 2 ;

  // Дата и время создания заказа
  google.protobuf.Timestamp date_time = 3;

  // Способ получения заказа
  com.gastroflow.common.PackingMode packing_mode = 4;

  // Позиции в заказе
  repeated Position positions = 5 ;

  // Общая сумма заказа
  com.gastroflow.common.Money total = 6;

  // Готовность всего заказа
  bool is_ready = 7;

  // Контактная информация клиента
  com.gastroflow.common.ContactInfo contact_info = 8;

  // Время приготовления в минутах (расчетное)
  int32 duration = 9 ;

  // Адрес доставки (только для доставки)
  com.gastroflow.common.Address address = 10;

  // Внешний номер заказа (для интеграций)
  string external_order_number = 11;

  // Идентификатор примененного промокода
  com.gastroflow.common.UUID promo_code_id = 12;

  // Способ оплаты
  com.gastroflow.common.PaymentMethod payment_method = 13;

  // Текущий статус заказа
  com.gastroflow.common.OrderStatus status = 14;

  // Режим времени приготовления
  com.gastroflow.common.PreparingTimeMode preparing_time_mode = 15;

  // Желаемое время готовности (для режима "К времени")
  google.protobuf.Timestamp desired_ready_time = 16;

  // Идентификатор ресторана (мультитенантность)
  com.gastroflow.common.UUID restaurant_id = 17;

  // Комментарий к заказу
  string comment = 18;

  // Информация о скидке
  DiscountInfo discount = 19;

  // Информация об аудите
  com.gastroflow.common.AuditInfo audit_info = 20;
}

// Position - позиция в заказе
message Position {
  // Уникальный идентификатор позиции
  com.gastroflow.common.UUID id = 1;

  // Название позиции
  string name = 2 ;

  // Базовая цена позиции
  com.gastroflow.common.Money price = 3;

  // Количество единиц данной позиции
  int32 quantity = 4 ;

  // Выбранные варианты для позиции
  repeated Variant selected_variants = 5;

  // Комментарий к позиции от клиента
  string comment = 6;

  // Готовность позиции
  bool is_ready = 7;

  // Идентификатор родительской категории меню
  com.gastroflow.common.UUID parent_id = 8;

  // Идентификатор позиции в меню (для связи с каталогом)
  com.gastroflow.common.UUID menu_item_id = 9;

  // Время приготовления позиции в минутах
  int32 cooking_time = 10 ;

  // Специальные инструкции для кухни
  string cooking_instructions = 11;
}

// Variant - вариант позиции (размер, добавка и т.д.)
message Variant {
  // Название варианта (например, "Большая порция", "Без лука")
  string name = 1 ;

  // Дополнительная цена за вариант (может быть отрицательной для скидок)
  com.gastroflow.common.Money price = 2;

  // Идентификатор варианта в меню
  com.gastroflow.common.UUID variant_id = 3;

  // Категория варианта (размер, добавка, исключение и т.д.)
  string category = 4;
}

// DiscountInfo - информация о скидке на заказ
message DiscountInfo {
  // Размер скидки
  com.gastroflow.common.Money amount = 1;

  // Процент скидки (если применимо)
  double percentage = 2;

  // Тип скидки
  DiscountType type = 3;

  // Описание скидки
  string description = 4;

  // Код промокода (если скидка по промокоду)
  string promo_code = 5;
}

// DiscountType - тип скидки
enum DiscountType {
  DISCOUNT_TYPE_UNSPECIFIED = 0;
  DISCOUNT_TYPE_FIXED_AMOUNT = 1; // Фиксированная сумма
  DISCOUNT_TYPE_PERCENTAGE = 2; // Процент от суммы
  DISCOUNT_TYPE_PROMO_CODE = 3; // По промокоду
  DISCOUNT_TYPE_LOYALTY = 4; // Программа лояльности
  DISCOUNT_TYPE_FIRST_ORDER = 5; // Скидка на первый заказ
}
