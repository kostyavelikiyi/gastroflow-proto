syntax = "proto3";

package com.gastroflow.users;

import "google/protobuf/timestamp.proto";
import "common/types.proto";
import "common/enums.proto";
import "validate/validate.proto";

option go_package = "github.com/gastroflow/proto-go/users";

// User - основная сущность пользователя системы
message User {
  // Уникальный идентификатор пользователя
  com.gastroflow.common.UUID id = 1 [(validate.rules).message.required = true];
  
  // Имя пользователя
  string first_name = 2 [(validate.rules).string = {
    min_len: 1,
    max_len: 50
  }];
  
  // Фамилия пользователя
  string last_name = 3 [(validate.rules).string.max_len = 50];
  
  // Контактная информация
  com.gastroflow.common.ContactInfo contact_info = 4 [(validate.rules).message.required = true];
  
  // Роль пользователя в системе
  com.gastroflow.common.UserRole role = 5 [(validate.rules).enum = {
    not_in: [0]
  }];
  
  // Статус пользователя
  UserStatus status = 6 [(validate.rules).enum = {
    not_in: [0]
  }];
  
  // Предпочтительный язык
  com.gastroflow.common.Language preferred_language = 7 [(validate.rules).enum = {
    not_in: [0]
  }];
  
  // Адреса пользователя
  repeated UserAddress addresses = 8 [(validate.rules).repeated.max_items = 10];
  
  // Настройки пользователя
  UserSettings settings = 9;
  
  // Информация о профиле
  UserProfile profile = 10;
  
  // Привязки к ресторанам (для сотрудников)
  repeated RestaurantBinding restaurant_bindings = 11 [(validate.rules).repeated.max_items = 50];
  
  // Дата последней активности
  google.protobuf.Timestamp last_activity_at = 12;
  
  // Активен ли пользователь
  bool is_active = 13;
  
  // Информация об аудите
  com.gastroflow.common.AuditInfo audit_info = 14 [(validate.rules).message.required = true];
}

// UserAddress - адрес пользователя
message UserAddress {
  // Уникальный идентификатор адреса
  com.gastroflow.common.UUID id = 1 [(validate.rules).message.required = true];
  
  // Адрес
  com.gastroflow.common.Address address = 2 [(validate.rules).message.required = true];
  
  // Тип адреса
  AddressType type = 3 [(validate.rules).enum = {
    not_in: [0]
  }];
  
  // Название адреса (например, "Дом", "Офис")
  string label = 4 [(validate.rules).string.max_len = 50];
  
  // Адрес по умолчанию
  bool is_default = 5;
  
  // Активность адреса
  bool is_active = 6;
  
  // Информация об аудите
  com.gastroflow.common.AuditInfo audit_info = 7 [(validate.rules).message.required = true];
}

// UserSettings - настройки пользователя
message UserSettings {
  // Получать уведомления о статусе заказа
  bool notifications_order_status = 1;
  
  // Получать промо-уведомления
  bool notifications_promotions = 2;
  
  // Получать уведомления о новых блюдах
  bool notifications_new_items = 3;
  
  // Получать Email уведомления
  bool notifications_email = 4;
  
  // Получать SMS уведомления
  bool notifications_sms = 5;
  
  // Получать Push уведомления
  bool notifications_push = 6;
  
  // Темная тема интерфейса
  bool dark_theme = 7;
  
  // Автоматически сохранять адреса доставки
  bool auto_save_addresses = 8;
  
  // Запомнить способ оплаты
  bool remember_payment_method = 9;
  
  // Способ оплаты по умолчанию
  com.gastroflow.common.PaymentMethod default_payment_method = 10;
  
  // Временная зона пользователя
  string timezone = 11 [(validate.rules).string.max_len = 50];
}

// UserProfile - профиль пользователя
message UserProfile {
  // URL аватара пользователя
  string avatar_url = 1 [(validate.rules).string.max_len = 500];
  
  // Дата рождения
  google.protobuf.Timestamp birth_date = 2;
  
  // Пол пользователя
  Gender gender = 3;
  
  // О себе
  string bio = 4 [(validate.rules).string.max_len = 1000];
  
  // Диетические предпочтения
  repeated DietaryPreference dietary_preferences = 5 [(validate.rules).repeated.max_items = 20];
  
  // Любимые рестораны
  repeated com.gastroflow.common.UUID favorite_restaurants = 6 [(validate.rules).repeated.max_items = 100];
  
  // Любимые блюда
  repeated com.gastroflow.common.UUID favorite_menu_items = 7 [(validate.rules).repeated.max_items = 200];
  
  // Программа лояльности
  LoyaltyInfo loyalty_info = 8;
}

// RestaurantBinding - привязка пользователя к ресторану
message RestaurantBinding {
  // Идентификатор ресторана
  com.gastroflow.common.UUID restaurant_id = 1 [(validate.rules).message.required = true];
  
  // Роль в ресторане
  com.gastroflow.common.UserRole role = 2 [(validate.rules).enum = {
    not_in: [0]
  }];
  
  // Филиал (если привязка к конкретному филиалу)
  com.gastroflow.common.UUID branch_id = 3;
  
  // Активна ли привязка
  bool is_active = 4;
  
  // Дата начала работы
  google.protobuf.Timestamp start_date = 5 [(validate.rules).timestamp.required = true];
  
  // Дата окончания работы
  google.protobuf.Timestamp end_date = 6;
  
  // Дополнительные разрешения
  repeated Permission permissions = 7 [(validate.rules).repeated.max_items = 50];
}

// LoyaltyInfo - информация о программе лояльности
message LoyaltyInfo {
  // Уровень лояльности
  LoyaltyLevel level = 1 [(validate.rules).enum = {
    not_in: [0]
  }];
  
  // Текущие баллы
  int64 current_points = 2 [(validate.rules).int64.gte = 0];
  
  // Общее количество заработанных баллов
  int64 total_earned_points = 3 [(validate.rules).int64.gte = 0];
  
  // Общее количество потраченных баллов
  int64 total_spent_points = 4 [(validate.rules).int64.gte = 0];
  
  // Количество заказов
  int32 total_orders = 5 [(validate.rules).int32.gte = 0];
  
  // Общая сумма заказов
  com.gastroflow.common.Money total_spent = 6;
  
  // Дата регистрации в программе лояльности
  google.protobuf.Timestamp registered_at = 7 [(validate.rules).timestamp.required = true];
}

// Session - пользовательская сессия
message Session {
  // Идентификатор сессии
  string session_id = 1 [(validate.rules).string = {
    min_len: 1,
    max_len: 128
  }];
  
  // Идентификатор пользователя
  com.gastroflow.common.UUID user_id = 2 [(validate.rules).message.required = true];
  
  // Время создания сессии
  google.protobuf.Timestamp created_at = 3 [(validate.rules).timestamp.required = true];
  
  // Время истечения сессии
  google.protobuf.Timestamp expires_at = 4 [(validate.rules).timestamp.required = true];
  
  // Время последней активности
  google.protobuf.Timestamp last_activity_at = 5 [(validate.rules).timestamp.required = true];
  
  // IP адрес клиента
  string client_ip = 6 [(validate.rules).string.max_len = 45];
  
  // User Agent клиента
  string client_user_agent = 7 [(validate.rules).string.max_len = 500];
  
  // Устройство клиента
  DeviceInfo device_info = 8;
  
  // Активна ли сессия
  bool is_active = 9;
}

// DeviceInfo - информация об устройстве
message DeviceInfo {
  // Тип устройства
  DeviceType device_type = 1 [(validate.rules).enum = {
    not_in: [0]
  }];
  
  // Операционная система
  string os = 2 [(validate.rules).string.max_len = 50];
  
  // Версия ОС
  string os_version = 3 [(validate.rules).string.max_len = 50];
  
  // Браузер (для веб-клиентов)
  string browser = 4 [(validate.rules).string.max_len = 50];
  
  // Версия браузера
  string browser_version = 5 [(validate.rules).string.max_len = 50];
  
  // Версия приложения
  string app_version = 6 [(validate.rules).string.max_len = 50];
  
  // Токен для push уведомлений
  string push_token = 7 [(validate.rules).string.max_len = 500];
}

// Енумы для домена Users

// UserStatus - статус пользователя
enum UserStatus {
  USER_STATUS_UNSPECIFIED = 0;
  USER_STATUS_ACTIVE = 1;         // Активный
  USER_STATUS_INACTIVE = 2;       // Неактивный
  USER_STATUS_SUSPENDED = 3;      // Заблокированный
  USER_STATUS_PENDING = 4;        // Ожидает подтверждения
  USER_STATUS_DELETED = 5;        // Удален
}

// AddressType - тип адреса
enum AddressType {
  ADDRESS_TYPE_UNSPECIFIED = 0;
  ADDRESS_TYPE_HOME = 1;          // Домашний
  ADDRESS_TYPE_WORK = 2;          // Рабочий
  ADDRESS_TYPE_OTHER = 3;         // Другой
}

// Gender - пол пользователя
enum Gender {
  GENDER_UNSPECIFIED = 0;
  GENDER_MALE = 1;               // Мужской
  GENDER_FEMALE = 2;             // Женский
  GENDER_OTHER = 3;              // Другой
  GENDER_PREFER_NOT_TO_SAY = 4;  // Предпочитаю не указывать
}

// DietaryPreference - диетические предпочтения
enum DietaryPreference {
  DIETARY_PREFERENCE_UNSPECIFIED = 0;
  DIETARY_PREFERENCE_VEGETARIAN = 1;    // Вегетарианство
  DIETARY_PREFERENCE_VEGAN = 2;         // Веганство
  DIETARY_PREFERENCE_HALAL = 3;         // Халяль
  DIETARY_PREFERENCE_KOSHER = 4;        // Кошер
  DIETARY_PREFERENCE_GLUTEN_FREE = 5;   // Без глютена
  DIETARY_PREFERENCE_DAIRY_FREE = 6;    // Без молочных продуктов
  DIETARY_PREFERENCE_KETO = 7;          // Кетогенная диета
  DIETARY_PREFERENCE_LOW_CARB = 8;      // Низкоуглеводная диета
  DIETARY_PREFERENCE_NO_SPICY = 9;      // Без острого
}

// LoyaltyLevel - уровень лояльности
enum LoyaltyLevel {
  LOYALTY_LEVEL_UNSPECIFIED = 0;
  LOYALTY_LEVEL_BRONZE = 1;       // Бронзовый
  LOYALTY_LEVEL_SILVER = 2;       // Серебряный
  LOYALTY_LEVEL_GOLD = 3;         // Золотой
  LOYALTY_LEVEL_PLATINUM = 4;     // Платиновый
  LOYALTY_LEVEL_DIAMOND = 5;      // Алмазный
}

// Permission - разрешения пользователя
enum Permission {
  PERMISSION_UNSPECIFIED = 0;
  PERMISSION_VIEW_ORDERS = 1;           // Просмотр заказов
  PERMISSION_MANAGE_ORDERS = 2;         // Управление заказами
  PERMISSION_VIEW_MENU = 3;             // Просмотр меню
  PERMISSION_MANAGE_MENU = 4;           // Управление меню
  PERMISSION_VIEW_USERS = 5;            // Просмотр пользователей
  PERMISSION_MANAGE_USERS = 6;          // Управление пользователями
  PERMISSION_VIEW_ANALYTICS = 7;        // Просмотр аналитики
  PERMISSION_MANAGE_SETTINGS = 8;       // Управление настройками
  PERMISSION_MANAGE_RESTAURANT = 9;     // Управление рестораном
  PERMISSION_VIEW_PAYMENTS = 10;        // Просмотр платежей
  PERMISSION_MANAGE_INVENTORY = 11;     // Управление складом
}

// DeviceType - тип устройства
enum DeviceType {
  DEVICE_TYPE_UNSPECIFIED = 0;
  DEVICE_TYPE_WEB = 1;            // Веб-браузер
  DEVICE_TYPE_MOBILE_IOS = 2;     // iOS мобильное приложение
  DEVICE_TYPE_MOBILE_ANDROID = 3; // Android мобильное приложение
  DEVICE_TYPE_TABLET_IOS = 4;     // iOS планшет
  DEVICE_TYPE_TABLET_ANDROID = 5; // Android планшет
  DEVICE_TYPE_DESKTOP = 6;        // Десктопное приложение
}